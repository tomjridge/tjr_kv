<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Store_with_lru (tjr_kv.Tjr_kv.Store_with_lru)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">tjr_kv</a> &#x00BB; <a href="../index.html">Tjr_kv</a> &#x00BB; Store_with_lru</nav><h1>Module <code>Tjr_kv.Store_with_lru</code></h1><nav class="toc"><ul><li><a href="#simple-freespace">simple freespace</a></li><li><a href="#dmap-and-dmap_thread">DMAP and dmap_thread</a></li></ul></nav></header><aside><p>A KV store with the LRU frontend.</p></aside><aside><p>We construct:</p><ul><li>XXX Actually, work with references first XXX Functional store thread</li><li>this maintains the &quot;global&quot; state, including locks etc</li><li>the queues are kept separate since they are implemented using mutation anyway FIXME perhaps prefer a &quot;functional&quot; version using the functional store</li><li>includes:</li><li>lru_state</li><li>dmap_state</li><li>bt_state (a root pointer?)</li><li>also includes an Lwt_mvar for communication and implementation of with_state</li></ul><ul><li>LRU</li><li>q_lru_dcl (msg queue from lru to dcl)</li><li>Lru (and lru_state)</li><li>Lru_t, which takes messages from lru.to_lower to enqueue on q_lru_dcl</li></ul><ul><li>Dmap</li><li>q_dmap_bt (msg queue from dmap to btree)</li><li>Dmap and dmap_state</li><li>Dmap thread (Dmap_t)</li><li>takes msgs from q_dmap_btree and executes against dmap and B-tree</li></ul><ul><li>B-tree</li><li>B-tree</li><li>B-tree thread (Btree_t) listening to q_dmap_btree</li><li>also includes root pair functionality</li></ul><p>NOTE We refer to the combination of a Dmap and a B-tree as a RUM (for roll-up map).</p></aside><dl><dt class="spec value" id="val-lru_max_size"><a href="#val-lru_max_size" class="anchor"></a><code><span class="keyword">val</span> lru_max_size : int</code></dt><dt class="spec value" id="val-lru_evict_count"><a href="#val-lru_evict_count" class="anchor"></a><code><span class="keyword">val</span> lru_evict_count : int</code></dt><dt class="spec value" id="val-dmap_ops_per_block"><a href="#val-dmap_ops_per_block" class="anchor"></a><code><span class="keyword">val</span> dmap_ops_per_block : int</code></dt><dt class="spec value" id="val-dmap_blocks_limit"><a href="#val-dmap_blocks_limit" class="anchor"></a><code><span class="keyword">val</span> dmap_blocks_limit : int</code></dt><dt class="spec value" id="val-dmap_thread_delay"><a href="#val-dmap_thread_delay" class="anchor"></a><code><span class="keyword">val</span> dmap_thread_delay : float</code></dt><dt class="spec value" id="val-bt_thread_delay"><a href="#val-bt_thread_delay" class="anchor"></a><code><span class="keyword">val</span> bt_thread_delay : float</code></dt></dl><div class="spec module" id="module-Lru'"><a href="#module-Lru'" class="anchor"></a><code><span class="keyword">module</span> <a href="Lru'/index.html">Lru'</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><section><header><h3 id="simple-freespace"><a href="#simple-freespace" class="anchor"></a>simple freespace</h3></header><div class="spec module" id="module-Alloc"><a href="#module-Alloc" class="anchor"></a><code><span class="keyword">module</span> <a href="Alloc/index.html">Alloc</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section><section><header><h3 id="dmap-and-dmap_thread"><a href="#dmap-and-dmap_thread" class="anchor"></a>DMAP and dmap_thread</h3></header><div class="spec module" id="module-Dmap'"><a href="#module-Dmap'" class="anchor"></a><code><span class="keyword">module</span> <a href="Dmap'/index.html">Dmap'</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Btree'"><a href="#module-Btree'" class="anchor"></a><code><span class="keyword">module</span> <a href="Btree'/index.html">Btree'</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section></div></body></html>